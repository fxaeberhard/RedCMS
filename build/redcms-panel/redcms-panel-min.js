YUI.add("redcms-panel",function(a){var d=function(){return{_overlays:[],_bringToTop:function(s){var r=d._overlays,v=0,t=0,u;for(;t<r.length;t++){u=r[t].get("zIndex");if(u>v){v=u;}}s.set("zIndex",v+1);},register:function(r){d._overlays.push(r);r.get("boundingBox").on("mousedown",a.bind(this._bringToTop,this,r));d._bringToTop(r);}};}();a.namespace("RedCMS").OverlayManager=d;var i,b="overlayWindow",q="host",m="boundingBox",o="overlay",g="window",k="close",c=a.ClassNameManager.getClassName,l={window:c(o,g),close:c(o,k)};i=function(r){i.superclass.constructor.apply(this,arguments);};a.mix(i,{NAME:b,NS:g,CLASSES:l});a.extend(i,a.Plugin.Base,{_closeNode:null,initializer:function(r){this.doAfter("renderUI",this.renderUI);this.doAfter("bindUI",this.bindUI);this.doAfter("syncUI",this.syncUI);if(this.get(q).get("rendered")){this.renderUI();this.bindUI();this.syncUI();}},destructor:function(){var r=this.get(q).get(m);if(r._node){r.removeClass(l.window);}},renderUI:function(){var r=this.get(q),s=r.get(m);this._closeNode=a.Node.create('<a href="#"></a>');this._closeNode.addClass(l.close);s.append(this._closeNode);s.addClass(l.window);a.RedCMS.OverlayManager.register(r);},bindUI:function(){this._closeNode.on("click",function(r){try{this.get(q).destroy();}catch(r){}},this);},syncUI:function(){}});a.namespace("Plugin").OverlayWindow=i;var h,f,n="contentBox",m="boundingBox",e="body",j="click",p={LOADING:"yui3-redcms-loading"};h=a.Base.create("redcms-panel",a.Widget,[a.RedCMS.RedCMSWidget],{_overlay:null,_widgets:null,initializer:function(r){this.publish("submit");},bindUI:function(){this.get(n).one("a").on(j,function(t){t.preventDefault();var r=this.get(n),u=[],s=r.getAttribute("params");this._overlay=new a.Overlay({bodyContent:"<div></div>",headerContent:r.one("a").getContent(),zIndex:100,constrain:"body",render:true,visible:true,align:{points:["cc","cc"]},plugins:[{fn:a.Plugin.OverlayWindow},{fn:a.Plugin.Drag}]});this._overlay.dd.addHandle(".yui3-widget-hd");this._overlay.getStdModNode(e).addClass(p.LOADING);this._overlay.after("render",function(w){var v=new a.Resize({node:this.getStdModNode(e),handles:["b","r","br","bl"]});this.set("align",{points:["cc","cc"]});});if(s){u=a.JSON.parse(s);}a.io(r.one("a").get("href"),{data:u,on:{success:function(y,x,w){var v=this._overlay.getStdModNode(e);v.append(x.responseText);this._overlay.set("align",{points:["cc","cc"]});a.RedCMS.RedCMSManager.render(v,a.bind(this._onWidgetsRendered,this));}},context:this});},this);},destructor:function(){this._destroyOverlay();},_destroyOverlay:function(){try{for(var r=0;r<this._widgets.length;r++){this._widgets[r].destroy();}this._overlay.destroy();}catch(s){}},_onWidgetsRendered:function(t){var v=a.bind(this._onSuccess,this),u=a.bind(this._onWidgetsRendered,this),r=a.bind(this._onSelect,this),s=0;for(;s<t.length;s++){t[s].on("success",v);t[s].on("reload",u);t[s].on("redcms:select",r);}this._overlay.getStdModNode(e).removeClass(p.LOADING);this._overlay.set("align",{points:["cc","cc"]});this._widgets=t;},_onSelect:function(t){var s=this.getEvent("redcms:select"),r=false,u;for(u in s.subscribers){r=true;}if(r){this.fire("redcms:select",t);this._destroyOverlay();}},_onSuccess:function(){this.fire("success");this._destroyOverlay();}},{});a.namespace("RedCMS").OpenPanelAction=h;f=a.Base.create("redcms-blockreloadopenpanelaction",a.RedCMS.OpenPanelAction,[],{_reloadWidget:function(){var s=this.get(n).ancestor(function(t){return(t.getAttribute("redadmin")!="");},true),r=a.Widget.getByNode(s);a.RedCMS.RedCMSManager.reloadWidget(r);},bindUI:function(){f.superclass.bindUI.apply(this,arguments);this.on("success",this._reloadWidget);}},{});a.namespace("RedCMS").BlockReloadOpenPanelAction=f;},"@VERSION@",{requires:["redcms-base","overlay","widget-anim","json","dd-plugin","io-base","resize","plugin","event-focus"]});