YUI.add("redcms-admin",function(d){var c,a="boundingBox",b="contentBox";c=d.Base.create("contextmenu",d.Widget,[d.WidgetPosition,d.WidgetStack],{renderUI:function(){var f=this.get(a),e=this.get(b);f.setStyle("position","absolute");e.setContent('<div class="yui3-menu" />');e.one(".yui3-menu").plug(d.Plugin.NodeMenuNav);},bindUI:function(){var g=this.get(a),e=this.get(b),f=d.bind(this.hide,this);g.on("mouseupoutside",f);g.on("click",f);d.one("body").on("contextmenu",function(j){var i=j.target.ancestor("[redid]",true),h=j.target.ancestors(function(l){return(l.getAttribute("redadmin")!="");},true),k=e.one("div");if(i&&h.size()>0){j.halt();this.show();this.move(j.clientX+d.DOM.docScrollX(),j.clientY+d.DOM.docScrollY());k.setContent(this._getMenuMarkupFromAdminNodesList(i,h));d.RedCMS.RedCMSManager.render(k,d.bind(this._onContextMenuItemsRendered,this,i));}},this);},_onContextMenuItemsRendered:function(g,f){if(f.length!=this._adminNodes.length){}for(var e=0;e<f.length;e++){f[e].on("success",d.bind(this._onContextMenuItemSuccess,this,g,this._adminNodes[e]));}},_onContextMenuItemSuccess:function(f,h){var e=d.Widget.getByNode(h),g;if(!e){g=f.ancestor(function(i){return(i.getAttribute("redadmin")!="");},true);e=d.Widget.getByNode(g);}d.RedCMS.RedCMSManager.reloadWidget(e);},_adminNodes:null,_getMenuMarkupFromAdminNodesList:function(n,h){var j=['<div class="yui3-menu-content">'],g=false,l,k,f;this._adminNodes=[];for(k=h.size()-1;k>=0;k--){l=h.item(k);try{f=d.JSON.parse(decodeURI(l.getAttribute("redadmin")));}catch(m){}if(f.length>0){if(g){j.push("<ul>");}else{j.push('<ul class="first-of-type">');}j=j.concat(this._getMenuMarkupFromAdminNode(n,l,f));j.push("</ul>");g=true;}}j.push("</div>");if(j.length>2){return j.join("");}else{return"";}},_getMenuMarkupFromAdminNode:function(j,l,n){var k=[],o,g,m,e,f,h;for(g=0;g<n.length;g++){o=n[g];m=true;if(o.filter!==undefined){m=o.filter.split("|").indexOf(j.getAttribute("widget"))>-1;}if(m){e=o.href;f={};h=d.RedCMS.RedCMSManager.getParentBlock(j);if(o.action=="editCurrent"){f.id=j.getAttribute("redid");}else{if(o.action=="addSibling"){if(h){f.parentId=h.getAttribute("redid");}else{m=false;}}else{if(o.action=="addChild"){f.parentId=j.getAttribute("redid");}else{if(o.action=="editRoot"){if(l){f.id=l.getAttribute("redid");}else{m=false;}}else{if(o.action=="addChildToRoot"){if(l){f.parentId=l.getAttribute("redid");}else{m=false;}}else{if(o.action=="replaceHref"){e=j.one("a").get("href");}}}}}}}if(m){k.push("<li ");if(!o.children){k.push('class="yui3-menuitem" ');}k.push('widget="',o.widget,'" params="',d.RedCMS.RedCMSManager.escapeAttribute(d.JSON.stringify(f)),'" >');if(o.children){k.push('<a class="yui3-menu-label" href="',e,'" >',o.label,'</a><div class="yui3-menu yui3-menu-hidden"><div class="yui3-menu-content"><ul class="first-of-type">');k=k.concat(this._getMenuMarkupFromAdminNode(j,l,o.children));k.push("</ul></div></div>");}else{this._adminNodes.push(l);k.push('<a class="yui3-menuitem-content" href="',e,'" >',o.label,"</a>");}k.push("</li>");}}return k;}});d.namespace("RedCMS").ContextMenu=c;d.RedCMS.cm=new c({zIndex:1000,render:true,visible:false});},"@VERSION@",{requires:["widget","widget-position","widget-stack","widget-position-align","async-queue","json","gallery-outside-events","redcms-menunav","redcms-panel"]});