YUI.add("redcms-form",function(b){var f,i,k="boundingBox",l="contentBox",a="form",g="label",d="invalid",e="input",h="<div ></div>",c=b.ClassNameManager.getClassName,j={invalid:c(a,d),label:c(a,g),input:c(a,e)};f=b.Base.create("redcms-form",b.Form,[b.RedCMS.RedCMSWidget],{_msgBox:null,_getMsgBox:function(){return this._msgBox;},_parseFields:function(n){var m=[];try{m=b.JSON.parse(b.RedCMS.RedCMSManager.urldecode(n.getContent()));}catch(o){}n.setContent("");return m;},submit:function(){if(this.get("skipValidationBeforeSubmit")===true||this._runValidation()){this.fire("submit");this.showReloadOverlay();b.RedCMS.Form.superclass.submit.apply(this);}},renderUI:function(){this._msgBox=new b.RedCMS.MsgBox({visible:false});this._msgBox.render();this.get(l).appendChild(this._msgBox.get(k));this.on("complete",function(n){this.hideReloadOverlay();var m=b.JSON.parse(n.response.responseText);if(m.result=="success"){this.get("msgBox").setMessage(b.RedCMS.MsgBox.CLASSES.success,m.msg);}else{this.get("msgBox").setMessage(b.RedCMS.MsgBox.CLASSES.error,m.msg);}});this.on("failure",function(m){this.hideReloadOverlay();this.get("msgBox").setMessage(b.RedCMS.MsgBox.CLASSES.error,"Error sending form content");});this.after("render",function(){this.set("resetAfterSubmit",false);this.set("validateInline",true);this.each(function(m){if(m instanceof b.FileField){this.set("encodingType",b.Form.MULTIPART_ENCODED);this.on("complete",function(){this.fire("success");});}},this);this.get(l).removeClass("redcms-hidden");});}},{ATTRS:{msgBox:{getter:"_getMsgBox",readOnly:true}}});b.namespace("RedCMS").Form=f;b.RedCMS.FormField=function(){return{LABEL_BOUNDINGBOX_TEMPLATE:"<div />",CLASSES:j,ATTRS:{redid:{validator:b.Lang.isString,writeOnce:true}}};};b.RedCMS.FormField.prototype={_renderLabelNode:function(){var m=this.get(l),n=m.one("label"),o;if(this.get("required")){m.addClass("yui3-form-field-required");}if(!n||n.get("for")!=this.get("id")){o=b.Node.create(h);o.addClass(j.label);o.addClass("yui3-u");m.addClass("yui3-g");m.setAttribute("redid",this.get("redid"));m.setAttribute("widget","FormField");m.appendChild(o);n=b.Node.create(b.FormField.LABEL_TEMPLATE);o.appendChild(n);o.destroy();}this._labelNode=n;},_renderFieldNode:function(){var m=this.get(l),n=m.one("#"+this.get("id")),o;if(!n){o=b.Node.create(h);o.addClass(j.input);o.addClass("yui3-u");m.appendChild(o);n=b.Node.create(b.FormField.INPUT_TEMPLATE);o.appendChild(n);}this._fieldNode=n;},_showError:function(n){var m=this.get(l),o=b.Node.create("<span>"+n+"</span>");o.addClass("error");m.append(o);this._errorNode=o;m.addClass(j.invalid);},_clearError:function(){if(this._errorNode){var m=this.get(l);m.removeChild(this._errorNode);this._errorNode=null;m.removeClass(j.invalid);}}};b.mix(b.FormField,b.RedCMS.FormField(),true,[],0,true);b.augment(b.FormField,b.RedCMS.FormField,true);b.ChoiceField.prototype._renderLabelNode=b.RedCMS.FormField.prototype._renderLabelNode;b.TextareaField.prototype._renderFieldNode=function(){var m=this.get("contentBox"),n=m.one("#"+this.get("id")),o;if(!n){o=b.Node.create(h);o.addClass(j.input);o.addClass("yui3-u");m.appendChild(o);m.setAttribute("redid",this.get("redid"));n=b.Node.create(b.TextareaField.NODE_TEMPLATE);n.setAttrs({name:this.get("name"),innerHTML:this.get("value")});o.appendChild(n);}n.setAttribute("tabindex",b.FormField.tabIndex);b.FormField.tabIndex++;this._fieldNode=n;};i=b.Base.create("redcms-simpleform",b.Widget,[b.RedCMS.RedCMSWidget],{renderUI:function(){this.get(l).one("form").on("submit",b.bind(function(n){n.halt();var m=this.get(l).one("form");b.io(m.get("action"),{method:m.get("method"),form:{id:m},on:{success:function(r,q,p){this.fire("success");}},context:this});},this));}},{});b.namespace("RedCMS").SimpleForm=i;b.DateField=b.Base.create("editor-field",b.TextField,[],{_overlay:null,_clickHandler:null,_calendar:null,_showCalendar:function(m){this._overlay.show();this._overlay.set("align",{node:this._fieldNode,points:["tc","bc"]});m.halt();if(!this._clickHandler){this._clickHandler=b.on("click",b.bind(function(o){o.halt();var n=o.currentTarget.ancestor(".yui3-form-calendar-overlay",true);if(!n){this._overlay.hide();this._clickHandler.detach();this._clickHandler=null;}},this),"body div");}},_padNumber:function(m){return(m<10?"0":"")+m;},renderUI:function(){b.DateField.superclass.renderUI.apply(this,arguments);this._fieldNode.setAttribute("readonly","readonly");b.use("yui2-calendar",b.bind(function(r){var q=r.YUI2,o=r.Node.create('<div class="yui3-form-calendar-overlay"></div>'),m=r.Node.create("<div></div>"),p,n=new r.Overlay({contentBox:o,visible:false,width:"170px",zIndex:1000,align:{node:this._fieldNode,points:["tc","bl"]}});r.one("body").appendChild(o);o.appendChild(m);n.render();this._overlay=n;p=new q.widget.Calendar(o.get("id"));p.render();this._calendar=p;this._calendar.selectEvent.subscribe(r.bind(function(t,s){s=s[0][0];this.set("value",this._padNumber(s[1])+"/"+this._padNumber(s[2])+"/"+s[0]);this._overlay.hide();this._clickHandler.detach();this._clickHandler=null;},this));},this));},bindUI:function(){b.DateField.superclass.bindUI.apply(this,arguments);this._fieldNode.on("click",this._showCalendar,this);this._fieldNode.on("focus",this._showCalendar,this);}},{NAME:"date-field"});b.EditorField=b.Base.create("editor-field",b.TextareaField,[],{_editor:null,_createlinkRendered:false,_insertimageRendered:false,_onWindowButtonSelect:function(m,n){m.set("value",n.href);m.focus();m.blur();},_onWindowButtonRendered:function(p,o){var m=b.bind(this._onWindowButtonSelect,this,p),n=0;for(;n<o.length;n++){o[n].on("redcms:select",m);}},_renderFieldNode:function(){b.EditorField.superclass._renderFieldNode.apply(this);b.use("yui2-editor",b.bind(function(o){var n=o.YUI2,m=new n.widget.Editor(this._fieldNode._node,{height:"200px",width:"98%",animate:true,autoHeight:true,filterWord:true});this.get("parent").on("submit",function(p){this._editor.saveHTML();},this);this._editor=m;m.addListener("toolbarLoaded",function(p,q){this._editor.subscribe("afterOpenWindow",function(w){var s=w.win,v=new o.Node(s.body.firstChild),u=v.get("children").item(1),t=o.bind(this._onWindowButtonRendered,this,u),r,x;
switch(s.name){case"insertimage":if(!this._insertimageRendered){u.setStyle("width","270px");x=o.Node.create('<span class="yui3-redcms-button" widget="OpenPanelAction"'+'params="'+o.RedCMS.RedCMSManager.escapeAttribute('{"filter":"jpg,jpeg,png,bmp,gif"}')+'" requires="redcms-panel"><span>'+'<a class="yui3-redcms-button-addfile" href="'+o.RedCMS.RedCMSManager.getLink("fileManager")+'" ></a>'+"</span></span>");x.appendTo(v);o.RedCMS.RedCMSManager.render(v,t);this._insertimageRendered=true;}break;case"createlink":if(!this._createlinkRendered){u.setStyle("width","190px");r=o.Node.create('<span class="yui3-redcms-button" widget="OpenPanelAction" requires="redcms-panel"><span>'+'<a class="yui3-redcms-button-addpage" href="'+o.RedCMS.RedCMSManager.getLink("pageManager")+'" ></a>'+"</span></span>");r.setStyle("float","left");r.appendTo(v);x=o.Node.create('<span class="yui3-redcms-button" widget="OpenPanelAction" requires="redcms-panel"><span>'+'<a class="yui3-redcms-button-addfile" href="'+o.RedCMS.RedCMSManager.getLink("fileManager")+'" ></a>'+"</span></span>");x.setStyle("float","left");x.appendTo(v);o.RedCMS.RedCMSManager.render(v,t);this._createlinkRendered=true;}break;}},null,this);},null,this);m.render();},this));}},{});},"@VERSION@",{requires:["redcms-base","gallery-form","io-upload-iframe","io-form","redcms-msgbox","json"]});